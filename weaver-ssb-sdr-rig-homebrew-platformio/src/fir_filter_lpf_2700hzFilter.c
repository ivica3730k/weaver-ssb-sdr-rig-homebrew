#include "fir_filter_lpf_2700hzFilter.h"
#include <Arduino.h>
static int16_t filter_taps[FIR_FILTER_LPF_2700HZFILTER_TAP_NUM] = {
  184,
  44,
  48,
  51,
  52,
  53,
  52,
  49,
  46,
  40,
  34,
  26,
  18,
  9,
  -1,
  -10,
  -20,
  -28,
  -36,
  -43,
  -49,
  -53,
  -55,
  -55,
  -53,
  -50,
  -45,
  -38,
  -30,
  -22,
  -12,
  -3,
  7,
  16,
  23,
  30,
  35,
  38,
  39,
  38,
  35,
  29,
  22,
  13,
  3,
  -8,
  -19,
  -31,
  -41,
  -51,
  -59,
  -66,
  -70,
  -72,
  -71,
  -68,
  -62,
  -53,
  -43,
  -30,
  -17,
  -2,
  12,
  27,
  40,
  51,
  60,
  67,
  70,
  71,
  68,
  62,
  52,
  40,
  25,
  8,
  -10,
  -28,
  -46,
  -63,
  -79,
  -91,
  -101,
  -107,
  -109,
  -106,
  -100,
  -89,
  -74,
  -56,
  -35,
  -13,
  11,
  35,
  58,
  79,
  97,
  112,
  121,
  126,
  125,
  119,
  107,
  90,
  68,
  42,
  13,
  -19,
  -50,
  -82,
  -111,
  -137,
  -158,
  -174,
  -184,
  -186,
  -181,
  -167,
  -147,
  -119,
  -85,
  -46,
  -4,
  41,
  86,
  129,
  169,
  203,
  230,
  249,
  258,
  256,
  242,
  217,
  181,
  134,
  79,
  15,
  -53,
  -125,
  -196,
  -265,
  -328,
  -382,
  -424,
  -452,
  -463,
  -454,
  -425,
  -375,
  -302,
  -207,
  -91,
  44,
  197,
  364,
  543,
  729,
  919,
  1109,
  1294,
  1469,
  1631,
  1775,
  1899,
  1998,
  2071,
  2115,
  2130,
  2115,
  2071,
  1998,
  1899,
  1775,
  1631,
  1469,
  1294,
  1109,
  919,
  729,
  543,
  364,
  197,
  44,
  -91,
  -207,
  -302,
  -375,
  -425,
  -454,
  -463,
  -452,
  -424,
  -382,
  -328,
  -265,
  -196,
  -125,
  -53,
  15,
  79,
  134,
  181,
  217,
  242,
  256,
  258,
  249,
  230,
  203,
  169,
  129,
  86,
  41,
  -4,
  -46,
  -85,
  -119,
  -147,
  -167,
  -181,
  -186,
  -184,
  -174,
  -158,
  -137,
  -111,
  -82,
  -50,
  -19,
  13,
  42,
  68,
  90,
  107,
  119,
  125,
  126,
  121,
  112,
  97,
  79,
  58,
  35,
  11,
  -13,
  -35,
  -56,
  -74,
  -89,
  -100,
  -106,
  -109,
  -107,
  -101,
  -91,
  -79,
  -63,
  -46,
  -28,
  -10,
  8,
  25,
  40,
  52,
  62,
  68,
  71,
  70,
  67,
  60,
  51,
  40,
  27,
  12,
  -2,
  -17,
  -30,
  -43,
  -53,
  -62,
  -68,
  -71,
  -72,
  -70,
  -66,
  -59,
  -51,
  -41,
  -31,
  -19,
  -8,
  3,
  13,
  22,
  29,
  35,
  38,
  39,
  38,
  35,
  30,
  23,
  16,
  7,
  -3,
  -12,
  -22,
  -30,
  -38,
  -45,
  -50,
  -53,
  -55,
  -55,
  -53,
  -49,
  -43,
  -36,
  -28,
  -20,
  -10,
  -1,
  9,
  18,
  26,
  34,
  40,
  46,
  49,
  52,
  53,
  52,
  51,
  48,
  44,
  184
};

void fir_filter_lpf_2700hzFilter_init(fir_filter_lpf_2700hzFilter* f) {
  int i;
  for(i = 0; i < FIR_FILTER_LPF_2700HZFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void fir_filter_lpf_2700hzFilter_put(fir_filter_lpf_2700hzFilter* f, uint16_t input) {
  f->history[f->last_index++] = input;
  if(f->last_index == FIR_FILTER_LPF_2700HZFILTER_TAP_NUM)
    f->last_index = 0;
}

uint16_t fir_filter_lpf_2700hzFilter_get(fir_filter_lpf_2700hzFilter* f) {
  long long acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < FIR_FILTER_LPF_2700HZFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : FIR_FILTER_LPF_2700HZFILTER_TAP_NUM-1;
    acc += (long long)f->history[index] * filter_taps[i];
  };
  return acc >> 16;
}
